(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"08c8":function(e,t,n){"use strict";n.r(t);var r=n("f555"),s=n("4512");for(var o in s)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(o);n("38e6");var i=n("f0c5"),a=Object(i["a"])(s["default"],r["b"],r["c"],!1,null,"7948c53b",null,!1,r["a"],void 0);t["default"]=a.exports},"2ed8":function(e,t,n){"use strict";(function(e,t){var r=n("4ea4");n("3d96");r(n("66fd"));var s=r(n("08c8"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"38e6":function(e,t,n){"use strict";var r=n("581d"),s=n.n(r);s.a},4512:function(e,t,n){"use strict";n.r(t);var r=n("c719"),s=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=s.a},"581d":function(e,t,n){},c719:function(e,t,n){"use strict";(function(e){var r=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(n("2eee")),o=r(n("c973")),i=r(n("a471")),a=n("c0ee"),u=r(n("0e30")),d=r(n("d604")),c={computed:{user:function(){return d.default}},data:function(){return{userStore:d.default,statusBarHeight:0,requestParam:{username:"",password:"",phoneAreaCode:"+86",loginTypeCode:"password",varCode:"",loginCode:""},passwordIsVisible:!1,isLogining:!1,sendVarCodeTime:0,isSendingVarCode:!1}},created:function(){this.initVarCodeTime(),this.intervalVarCodeTime()},mounted:function(){this.statusBarHeight=e.getSystemInfoSync().statusBarHeight},methods:{initVarCodeTime:function(){var t=e.getStorageSync("lastSendVarCodeTimeOfLogin");t&&(new Date).getTime()-t<6e4&&(this.sendVarCodeTime=60-Math.floor(((new Date).getTime()-t)/1e3))},intervalVarCodeTime:function(){var e=this;this.sendVarCodeTime>0&&(this.sendVarCodeTime--,setTimeout((function(){e.intervalVarCodeTime()}),1e3))},sendVarCode:function(){var t=this;if(this.initVarCodeTime(),!(this.sendVarCodeTime>0))if(""!=this.requestParam.username)if("password"!=this.requestParam.loginTypeCode||-1!=this.requestParam.username.indexOf("@")||0!=u.default.checkPhone(this.requestParam.phoneAreaCode,this.requestParam.username)){if("password"!=this.requestParam.loginTypeCode||-1==this.requestParam.username.indexOf("@")||0!=u.default.checkEmail(this.requestParam.username))return"varCode"==this.requestParam.loginTypeCode&&-1!=this.requestParam.username.indexOf("@")?(this.$refs.ktButton.loading(),this.isSendingVarCode=!0,void this.$request({url:"/api-varcode/varCode/send",method:"post",data:{typeCode:"email",sceneCode:"login",to:this.requestParam.username},stateSuccess:function(n){t.$refs.ktButton.success(n.msg),e.setStorageSync("lastSendVarCodeTimeOfLogin",(new Date).getTime()),t.isSendingVarCode=!1,t.initVarCodeTime(),t.intervalVarCodeTime()},stateFail:function(e){e.errMsg&&t.$refs.ktButton.error(e.errMsg),setTimeout((function(){t.isSendingVarCode=!1}),3e3)}})):"varCode"==this.requestParam.loginTypeCode&&-1==this.requestParam.username.indexOf("@")?(this.$refs.ktButton.loading(),this.isSendingVarCode=!0,void this.$request({url:"/api-varcode/varCode/send",method:"post",data:{typeCode:"sms",sceneCode:"login",to:this.requestParam.phoneAreaCode+this.requestParam.username},stateSuccess:function(n){t.$refs.ktButton.success(n.msg),e.setStorageSync("lastSendVarCodeTimeOfLogin",(new Date).getTime()),t.isSendingVarCode=!1,t.initVarCodeTime(),t.intervalVarCodeTime()},stateFail:function(e){e.errMsg&&t.$refs.ktButton.error(e.errMsg),setTimeout((function(){t.isSendingVarCode=!1}),3e3)}})):void 0;this.$refs.ktButton.error("请输入正确的邮箱")}else this.$refs.ktButton.error("请输入正确的手机号码");else this.$refs.ktButton.error("请输入手机号码或邮箱")},isIos:function(){return"ios"==e.getSystemInfoSync().platform},changeLoginType:function(e){this.requestParam.loginTypeCode=e},tipPhone:function(){e.showToast({title:"目前仅支持中国大陆手机号码",icon:"none",duration:2e3})},login:function(){""!=this.requestParam.username?"password"!=this.requestParam.loginTypeCode||-1!=this.requestParam.username.indexOf("@")||0!=u.default.checkPhone(this.requestParam.phoneAreaCode,this.requestParam.username)?"password"!=this.requestParam.loginTypeCode||-1==this.requestParam.username.indexOf("@")||0!=u.default.checkEmail(this.requestParam.username)?"password"!=this.requestParam.loginTypeCode||""!=this.requestParam.password?"varCode"!=this.requestParam.loginTypeCode||""!=this.requestParam.varCode?"password"!=this.requestParam.loginTypeCode||-1!=this.requestParam.username.indexOf("@")?"password"!=this.requestParam.loginTypeCode||-1==this.requestParam.username.indexOf("@")?"varCode"!=this.requestParam.loginTypeCode||-1==this.requestParam.username.indexOf("@")?"varCode"!=this.requestParam.loginTypeCode||-1!=this.requestParam.username.indexOf("@")||this.loginByPhoneAndVarCode():this.loginByEmailAndVarCode():this.loginByEmailAndPassword():this.loginByPhoneAndPassword():this.$refs.ktButton.error("请输入验证码"):this.$refs.ktButton.error("请输入密码"):this.$refs.ktButton.error("请输入正确的邮箱"):this.$refs.ktButton.error("请输入正确的手机号码"):this.$refs.ktButton.error("请输入手机号码或邮箱")},loginByPhoneAndPassword:function(){var e=this;return(0,o.default)(s.default.mark((function t(){var n,r,o;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLogining=!0,n="",r="",o=new a.JSEncrypt,t.next=6,i.default.getPublicKey().then((function(t){o.setPublicKey(t),n=t+"&&"+o.encrypt(e.requestParam.phoneAreaCode+e.requestParam.username),console.log("username",n)}));case 6:return t.next=8,i.default.getPublicKey().then((function(t){o.setPublicKey(t),r=t+"&&"+o.encrypt(e.requestParam.password)}));case 8:console.log("phone",n),console.log("password",r),e.$refs.ktButton.loading(),e.$request({url:"/system-user-web/user/securityLoginByPhoneAndPassword",method:"post",data:{phone:n,password:r},stateSuccess:function(t){e.$refs.ktButton.success(t.msg),e.$kt.request.setToken(t.data.token),e.userStore.setSelfInfo(t.data.userInfo),e.loginSuccess(t)},stateFail:function(t){console.log(t),e.$refs.ktButton.error(t.errMsg),e.isLogining=!1}});case 12:case"end":return t.stop()}}),t)})))()},loginByEmailAndPassword:function(){var e=this;return(0,o.default)(s.default.mark((function t(){var n,r,o;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLogining=!0,n="",r="",o=new a.JSEncrypt,t.next=6,i.default.getPublicKey().then((function(t){o.setPublicKey(t),n=t+"&&"+o.encrypt(e.requestParam.username)}));case 6:return t.next=8,i.default.getPublicKey().then((function(t){o.setPublicKey(t),r=t+"&&"+o.encrypt(e.requestParam.password)}));case 8:e.$refs.ktButton.loading(),e.$request({url:"/system-user-web/user/securityLoginByEmailAndPassword",method:"post",data:{email:n,password:r},stateSuccess:function(t){e.$refs.ktButton.success("登录成功"),e.$kt.request.setToken(t.data.token),e.userStore.setSelfInfo(t.data.userInfo),e.loginSuccess(t)},stateFail:function(t){console.log(t),e.$refs.ktButton.error(t.errMsg),e.isLogining=!1}});case 10:case"end":return t.stop()}}),t)})))()},loginByEmailAndVarCode:function(){var e=this;return(0,o.default)(s.default.mark((function t(){var n,r,o;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLogining=!0,n="",r="",o=new a.JSEncrypt,t.next=6,i.default.getPublicKey().then((function(t){o.setPublicKey(t),n=t+"&&"+o.encrypt(e.requestParam.username)}));case 6:return t.next=8,i.default.getPublicKey().then((function(t){o.setPublicKey(t),r=t+"&&"+o.encrypt(e.requestParam.varCode)}));case 8:e.$refs.ktButton.loading(),e.$request({url:"/system-user-web/user/securityLoginByEmailAndVarCode",method:"post",data:{email:n,varCode:r},stateSuccess:function(t){e.$refs.ktButton.success(t.msg),e.$kt.request.setToken(t.data.token),e.userStore.setSelfInfo(t.data.userInfo),e.loginSuccess(t),e.isLogining=!1},stateFail:function(t){t.errMsg&&e.$refs.ktButton.error(t.errMsg),e.isLogining=!1}});case 10:case"end":return t.stop()}}),t)})))()},loginByPhoneAndVarCode:function(){var e=this;return(0,o.default)(s.default.mark((function t(){var n,r,o;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLogining=!0,n="",r="",o=new a.JSEncrypt,t.next=6,i.default.getPublicKey().then((function(t){o.setPublicKey(t),n=t+"&&"+o.encrypt(e.requestParam.phoneAreaCode+e.requestParam.username)}));case 6:return t.next=8,i.default.getPublicKey().then((function(t){o.setPublicKey(t),r=t+"&&"+o.encrypt(e.requestParam.varCode)}));case 8:e.$refs.ktButton.loading(),e.$request({url:"/system-user-web/user/securityLoginBySmsAndVarCode",method:"post",data:{phone:n,varCode:r},stateSuccess:function(t){e.$refs.ktButton.success(t.msg),e.$kt.request.setToken(t.data.token),e.userStore.setSelfInfo(t.data.userInfo),e.loginSuccess(t),e.isLogining=!1},stateFail:function(t){t.errMsg&&e.$refs.ktButton.error(t.errMsg),e.isLogining=!1}});case 10:case"end":return t.stop()}}),t)})))()},loginSuccess:function(t){console.log(t),t.data.userInfo.isTemporary?e.redirectTo({url:"/pages/bind/bind"}):t.data.userInfo.isInit?getCurrentPages().length>1?e.navigateBack():e.navigateTo({url:"/pages/body/body"}):e.redirectTo({url:"/pages/init/init"})},getLoginCodeOfWechat:function(){var t=this;this.isLogining||(this.isLogining=!0,this.$refs.ktButton.loading(),e.login({provider:"weixin",success:function(e){t.requestParam.loginCode=e.code,t.$request({url:"/third-party-web/wechat/loginInMp",method:"post",data:{code:t.requestParam.loginCode},stateSuccess:function(e){t.$refs.ktButton.success(e.msg),t.$kt.request.setToken(e.data.token),t.userStore.setSelfInfo(e.data.userInfo),t.loginSuccess(e)},stateFail:function(e){e.errMsg&&t.$refs.ktButton.error(e.errMsg),t.isLogining=!1}})}}))},getLoginCodeOfGoogle:function(){this.isLogining||(this.isLogining=!0,this.$refs.ktButton.loading(),e.login({provider:"google",success:function(e){console.log("google",e)},fail:function(e){console.log("google err",e)}}))}}};t.default=c}).call(this,n("543d")["default"])},f555:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={ktNavBar:function(){return n.e("uni_modules/uniapp-kantboot/components/kt-nav-bar/kt-nav-bar").then(n.bind(null,"dcfa"))},uRow:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-row/u-row")]).then(n.bind(null,"ed1c"))},uCol:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-col/u-col")]).then(n.bind(null,"865f"))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"10eb"))},ktButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uniapp-kantboot/components/kt-button/kt-button")]).then(n.bind(null,"7cc8"))},uGrid:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-grid/u-grid")]).then(n.bind(null,"2313"))},uGridItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-grid-item/u-grid-item")]).then(n.bind(null,"4625"))}},s=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$kt.file.byPath("image/login.png")),r=e.requestParam.username.indexOf("@");e._isMounted||(e.e0=function(t){e.passwordIsVisible=!e.passwordIsVisible}),e.$mp.data=Object.assign({},{$root:{g0:n,g1:r}})},o=[]}},[["2ed8","common/runtime","common/vendor"]]]);