(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bind/bind"],{"0037":function(e,t,n){"use strict";var s=n("af88"),i=n.n(s);i.a},5507:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return s}));var s={ktNavBar:function(){return n.e("uni_modules/uniapp-kantboot/components/kt-nav-bar/kt-nav-bar").then(n.bind(null,"dcfa"))},uRow:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-row/u-row")]).then(n.bind(null,"ed1c"))},uCol:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-col/u-col")]).then(n.bind(null,"865f"))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"10eb"))},ktButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uniapp-kantboot/components/kt-button/kt-button")]).then(n.bind(null,"7cc8"))}},i=function(){var e=this.$createElement,t=(this._self._c,this.userStore.state.selfInfo.email||this.userStore.state.selfInfo.phone?null:this.requestParam.username.indexOf("@")),n=this.$kt.file.byPath("image/bind.png");this.$mp.data=Object.assign({},{$root:{g0:t,g1:n}})},r=[]},"59d6":function(e,t,n){"use strict";n.r(t);var s=n("5507"),i=n("cb9e");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("0037");var o=n("f0c5"),a=Object(o["a"])(i["default"],s["b"],s["c"],!1,null,"0e1dcb89",null,!1,s["a"],void 0);t["default"]=a.exports},"648e":function(e,t,n){"use strict";(function(e){var s=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(n("2eee")),r=s(n("c973")),o=s(n("a471")),a=n("c0ee"),u=s(n("d604")),d={data:function(){return{userStore:u.default,bottomBoxHeight:0,requestParam:{username:"",password:"",phoneAreaCode:"+86",loginTypeCode:"varCode",varCode:"",loginCode:""},passwordIsVisible:!1,isLogining:!1,isSendingVarCode:!1,sendVarCodeTime:0}},created:function(){this.initVarCodeTime(),this.intervalVarCodeTime()},mounted:function(){var t=this;e.createSelectorQuery().select("#bottomBox").boundingClientRect((function(e){t.bottomBoxHeight=e.height})).exec()},methods:{initVarCodeTime:function(){var t=e.getStorageSync("lastSendVarCodeTimeOfBind");t&&(new Date).getTime()-t<6e4&&(this.sendVarCodeTime=60-Math.floor(((new Date).getTime()-t)/1e3))},intervalVarCodeTime:function(){var e=this;this.sendVarCodeTime>0&&(this.sendVarCodeTime--,setTimeout((function(){e.intervalVarCodeTime()}),1e3))},skipBind:function(){var e=this;this.$request({url:"/system-user-web/user/skipBind",method:"post",stateSuccess:function(t){e.loginSuccess(t)},stateFail:function(e){console.log(e)}})},loginSuccess:function(t){console.log(t),t.data.isInit?getCurrentPages().length>1?e.navigateBack():e.navigateTo({url:"/pages/body/body"}):e.redirectTo({url:"/pages/init/init"})},ifPhone:function(){return!this.userStore.state.selfInfo.email&&!this.userStore.state.selfInfo.phone&&-1==this.requestParam.username.indexOf("@")||!(!this.userStore.state.selfInfo.email||this.userStore.state.selfInfo.phone)},ifEmail:function(){return!this.userStore.state.selfInfo.email&&!this.userStore.state.selfInfo.phone&&-1!=this.requestParam.username.indexOf("@")||!(this.userStore.state.selfInfo.email||!this.userStore.state.selfInfo.phone)},sendVarCode:function(){this.userStore.state.selfInfo.email||this.userStore.state.selfInfo.phone||this.requestParam.username?(console.log(this.ifPhone(),this.ifEmail()),this.ifPhone()?this.sendPhoneVarCode():this.ifEmail()&&this.sendEmailVarCode()):this.$refs.ktButton.error("请输入手机号或者邮箱")},sendPhoneVarCode:function(){var t=this;this.requestParam.username?(this.isSendingVarCode=!0,this.$request({url:"/api-varcode/varCode/send",method:"post",data:{typeCode:"sms",sceneCode:"bind",to:this.requestParam.phoneAreaCode+this.requestParam.username},stateSuccess:function(n){t.$refs.ktButton.success(n.msg),e.setStorageSync("lastSendVarCodeTimeOfBind",(new Date).getTime()),t.isSendingVarCode=!1,t.initVarCodeTime(),t.intervalVarCodeTime()},stateFail:function(e){e.errMsg&&t.$refs.ktButton.error(e.errMsg),setTimeout((function(){t.isSendingVarCode=!1}),3e3)}})):this.$refs.ktButton.error("请输入手机号")},sendEmailVarCode:function(){var t=this;this.requestParam.username?(this.isSendingVarCode=!0,this.$request({url:"/api-varcode/varCode/send",method:"post",data:{typeCode:"email",sceneCode:"bind",to:this.requestParam.username},stateSuccess:function(n){t.$refs.ktButton.success(n.msg),e.setStorageSync("lastSendVarCodeTimeOfBind",(new Date).getTime()),t.isSendingVarCode=!1,t.initVarCodeTime(),t.intervalVarCodeTime()},stateFail:function(e){e.errMsg&&t.$refs.ktButton.error(e.errMsg),setTimeout((function(){t.isSendingVarCode=!1}),3e3)}})):this.$refs.ktButton.error("请输入邮箱")},submit:function(){this.userStore.state.selfInfo.email||this.userStore.state.selfInfo.phone||this.requestParam.username?this.ifPhone()?this.initBindBySmsAndVarCode():this.ifEmail()&&this.initBindByEmailAndVarCode():this.$refs.ktButton.error("请输入手机号或者邮箱")},initBindBySmsAndVarCode:function(){var e=this;return(0,r.default)(i.default.mark((function t(){var n,s,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLogining=!0,n="",s="",r=new a.JSEncrypt,t.next=6,o.default.getPublicKey().then((function(t){r.setPublicKey(t),n=t+"&&"+r.encrypt(e.requestParam.phoneAreaCode+e.requestParam.username)}));case 6:return t.next=8,o.default.getPublicKey().then((function(t){r.setPublicKey(t),s=t+"&&"+r.encrypt(e.requestParam.varCode)}));case 8:e.$refs.ktButton.loading(),e.$request({url:"/system-user-web/user/securityInitBindBySmsAndVarCode",method:"post",data:{phone:n,varCode:s},stateSuccess:function(t){e.$refs.ktButton.success(t.msg),e.userStore.setSelfInfo(t.data),e.loginSuccess(t),e.isLogining=!1},stateFail:function(t){t.errMsg&&e.$refs.ktButton.error(t.errMsg),e.isLogining=!1}});case 10:case"end":return t.stop()}}),t)})))()},initBindByEmailAndVarCode:function(){var e=this;return(0,r.default)(i.default.mark((function t(){var n,s,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLogining=!0,n="",s="",r=new a.JSEncrypt,t.next=6,o.default.getPublicKey().then((function(t){r.setPublicKey(t),n=t+"&&"+r.encrypt(e.requestParam.username)}));case 6:return t.next=8,o.default.getPublicKey().then((function(t){r.setPublicKey(t),s=t+"&&"+r.encrypt(e.requestParam.varCode)}));case 8:e.$refs.ktButton.loading(),e.$request({url:"/system-user-web/user/securityInitBindByEmailAndVarCode",method:"post",data:{email:n,varCode:s},stateSuccess:function(t){e.$refs.ktButton.success(t.msg),e.userStore.setSelfInfo(t.data),e.loginSuccess(t),e.isLogining=!1},stateFail:function(t){t.errMsg&&e.$refs.ktButton.error(t.errMsg),e.isLogining=!1}});case 10:case"end":return t.stop()}}),t)})))()}}};t.default=d}).call(this,n("543d")["default"])},af88:function(e,t,n){},cb9e:function(e,t,n){"use strict";n.r(t);var s=n("648e"),i=n.n(s);for(var r in s)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(r);t["default"]=i.a},d2d4:function(e,t,n){"use strict";(function(e,t){var s=n("4ea4");n("3d96");s(n("66fd"));var i=s(n("59d6"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["d2d4","common/runtime","common/vendor"]]]);